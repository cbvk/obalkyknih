[%PROCESS _header %]

<div style="width: 80%"> <!-- jinak to v IE dela jakousi neplechu.. :-( -->


<h1>Obálkyknih.cz 2.0 Integrace do knihovních katalogů<br></h1>Dokument popisuje způsob propojení služby obalkyknih.cz s webovým katalogem knihovny.<br><h3>Popis rozhraní obecně</h3>Integrace je provedena prostředky webových technologií. Služba se integruje připojením krátkého JavaScript kódu do HTML stránek webového katalogu, který zajistí stažení údajů o knize z webu obalkyknih.cz a vypsání těchto údajů vhodnou (modifikovatelnou) formou do stránky. Tomuto kódu je potřeba infomace o knížce sdělit, a to buď formou "obalení" informací do speciálních &lt;div class="obalky_..."&gt; značek nebo napsáním vlastního JavaScript kódu volajícího funkce API vloženého JavaScriptu obálek knih.<br><h3>Integrace s knihovním systémem Aleph</h3><div>1. Do adresáře <b>www_f_cze</b> přidejte nový soubor <b>obalky-aleph</b> s následujícím obsahem:<br><br>&lt;script&gt;<br>var obalky_url = (("https:" == document.location.protocol)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? "https://" : "http://")+"www.obalkyknih.cz";<br>document.write(unescape("%3Cscript src='" + obalky_url + "/api/functions.js' type='text/javascript'%3E%3C/script%3E"));<br>document.write(unescape("%3Cscript src='" + obalky_url + "/api/custom.js' type='text/javascript'%3E%3C/script%3E"));<br><br>function obalky_custom_onload() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var table = document.getElementById("fullbody");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var bibinfo = { "authors": [] };<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var permalink;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var rows = table.getElementsByTagName("tr");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i = 0; i &lt; rows.length; i++) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var tds = rows[i].getElementsByTagName("td");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var key = tds[0].innerText ? tds[0].innerText : tds[0].textContent;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var val = tds[1].innerText ? tds[1].innerText : tds[1].textContent;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var value = val ? val.replace(new<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RegExp("[\n\t ]+"+String.fromCharCode(36)),"").<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; replace(/^[\n\t ]+/,"") : ''; // 36 - Aleph dolary zere..<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(key.match(/ISBN/)) bibinfo["isbn"] = value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(key.match(/N.zev/) &amp;&amp; !key.match(/origin/)) bibinfo["title"] =<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value.replace(/\s+[\/\:].*/,'');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(key.match(/Rok vyd/)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bibinfo["year"] = value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(key.match(/SYSNO/i)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; permalink = "http://<b>ADRESA-VASEHO-OPACu</b>/"+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "F?func=find-c&amp;ccl_term=sys="+value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(key.match(/Auto/)) bibinfo["authors"].push( value );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obalky.process("obalky_display_mine","<b>obalka_nahled</b>",permalink,bibinfo);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obalky.onload();<br>}<br>&lt;/script&gt;<br><br>2. Do místa na stránce, kam chcete přidat obálku (např. do <b>full-set-tail</b>) přidat následující &lt;div&gt;:<br><br><b>&lt;div id="obalka_nahled" /&gt;</b><br><br>2. Do souboru <b>full-set-head</b> a do souboru <b>short-2-head</b> do elementu &lt;head&gt; doplnte:<br><br><b>&lt;include&gt;obalky-aleph</b><br><br>3. Do elementu &lt;body&gt; ve <b>full-set-head</b> a v <b>short-2-head</b> pridejte atribut <b>onload</b>:<br><br>&lt;body <b>onload="obalky.onload();window.focus();"</b>&gt;<br><br>4. Do <b>short-a-body</b> do sloupečku pro náhled obálky ve výsledcích hledání doplňte:<br><br>&lt;div class="obalky_book"&gt;<br>&nbsp;&nbsp; &lt;div class="obalky_permalink" style="display: none"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &gt;http://<b>ADRESA-VASEHO-OPACu</b>/F?func=find-c&amp;amp;ccl_term=sys=$0800&lt;/div&gt;<br>&nbsp;&nbsp; &lt;div class="obalky_bibinfo" style="display: none"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div class="obalky_isbn"&gt;$0700&lt;/div&gt;<br>&nbsp;&nbsp; &lt;/div&gt;<br>&nbsp;&nbsp; &lt;div class="obalky_callback" name="obalky_display_thumbnail"&gt;&lt;/div&gt;<br>&lt;/div&gt;<br><br>5. Přes prohlížeč a Zobrazení zdrojového kódu stránky se ujistěte, že Aleph do této &lt;div&gt; sekce správně generuje pole SYSNO a ISBN, případně toto generování upravte v <b>tab/www_tab_short.cze</b> v bibliografické bázi katalogu.<br><br><br></div><br>


<!--<div style="clear: both"></div>-->

<p style="height: 4em"/>

</div>

[%PROCESS _footer %]
